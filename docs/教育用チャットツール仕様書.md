# 教育用チャットツール 仕様書 
1. 概要 
    1. 目的 
        - Google Meetと併用して利用する教育用チャットツール。 Google Meetのチャット機能では全体への投稿しか できない問題を解決し、 教員と学生間の個別コミュニケーションを可能にする。 
    2. 利用環境 
        - Web経由で利用可能 
        - Google Meetと併用することを前提 
        - チャットツールは完全に独立したWebアプリケーション 
        - Google Meetとは別のURLで提供 
        - Google ClassroomなどにGoogle Meetのリンクとチャットツールのリンクをそれぞれ掲載 
        - 学生は2つのタブ/ウィンドウを開いて使用 
2. ユーザー認証・権限管理 
    1. 認証方式 
        - Google アカウントでの外部認証を使用 
    2. ユーザー権限 
        ### チャットルーム作成者 (教員) 
        - ルームを作成したユーザーは自動的に教員権限を持つ 
        #### 以下の操作が可能: 
        - 学生からの教員宛てDMの確認 
        - 学生へのDM送信 
        - 他ユーザーを教員に設定/解除 
        - ルームの終了 
        - チャットログのダウンロード 
        - ルームの削除 

        ### 追加教員
        - ルーム作成者が参加者の中から指定して教員権限を付与 
        - 「教員として設定」ボタンで権限付与 
        - ルーム作成者は教員権限を解除可能(誤操作対策) 
        - セッションごとにリセット: 次回の会議時には再度指定が必要 
        #### 以下の操作が可能: 
        - 学生からの教員宛てDMの確認 
        - 学生へのDM送信 

        ### 学生 
        - 招待リンクから参加したユーザー 
        - 教員として設定されない限り学生権限 
    3. 権限の制約 
        - 教員同士のDMは不可 
        - 学生同士のDMは不可 
    4. 参加フロー 
        ### 教員の場合 
        1. ログインページからGoogleアカウントでログイン 
        2. 自分が作成したチャットルーム一覧が表示される 
        3. ルームを選択して参加 
        
        ### 学生の場合 
        1. 授業ごとに異なる招待リンクを受け取る (Google Classroomなどに掲載) 
        2. リンクから直接チャットルームに参加 
        3. 初回アクセス時にGoogleアカウント認証が必要 
        4. 一度参加した学生も毎回リンクから入る 
3. メッセージ機能 
    1. メッセージの種類 
        ### 全体チャット 
        - 全参加者が閲覧可能 
        -  教員・学生ともに投稿可能 
        ### DM(ダイレクトメッセージ) 
        - 学生→教員DM: 学生が送信すると全教員に届く (他の学生には見えない) 
        - 教員→学生DM: 教員が特定の学生を指定して送信(指定した学生のみに届く)
        - 学生同士のDM: 不可 
        - 教員同士のDM: 不可 
    2. メッセージの制約 
        - テキストのみ (ファイル 画像の送信は不可) 
        - 送信後の編集・削除機能なし 
    3. 表示仕様 
        - 全体チャットとDMは同じ表示枠に表示 
        - DMメッセージは背景色を変えて区別 
        - 新しいメッセージは下に表示 
        - 既読・未読表示機能なし 
4. スレッド機能 
    1. 適用範囲 
        - DMのみで使用可能(全体チャットでは使用不可) 
    2. 仕様 
        - 返信ボタンで明示的にスレッドを作成 
        - スレッドの深さは1階層のみ (元メッセージ→返信群のフラット構造) 
        - スレッドはインライン表示 
    3. ユースケース例 
        1. 教員が全体チャットで「この答えをDMで連絡してね」 と投稿 
        2. 学生が教員へDMで 「Aです」 と送信 
        3. 教員がそのメッセージに返信ボタンで 「違います、 この点も考えてみてね」と返信 
        4. 学生が同じスレッドで 「Bだと思います」と送信 
        5. 教員は学生とのやり取りの履歴を時系列で確認可能 
5. スタンプ機能 
    1. 形式 
        - Slackスタイルのリアクション形式 
        - メッセージに対してスタンプを付ける 
    2. スタンプの種類 
        - 汎用的な絵文字スタンプ 
        -  システムであらかじめよく使うスタンプを用意 
            - √ 正解 
            - X 不正解 
            - いいね
            - ひらめき 
            - 考え中 
            - 素晴らしい 
            - 確認中 
    3. 使用権限 
        - 全参加者 (教員・学生)が使用可能 
    4. 適用範囲 
        - 全体チャット、 DM両方で使用可能 
6. チャットルーム管理 
    1. チャットルームの単位 
        - 1つの授業=1つのチャットルーム 
        - 同じ授業で日をまたいで使用する場合も同じチャットルームを使用 
        - 招待リンクのアドレスは変わらない 
    2. チャットルームの作成 
        - 教員がログイン後、新規チャットルームを作成 
        - 作成時に招待リンクが生成される 
    3. チャットルームへの参加 
        - 招待リンクからの参加のみ 
        - リンクを知っていればGoogleアカウントを持つ誰でも参加可能 
        - 招待リンクの有効期限なし 
        - ルーム削除時に招待リンクも無効化 
    4. チャットルームの削除 
        - ルーム作成者 (教員)がルームを削除可能 
        - 削除すると以下が実行される: 
            - チャットログも削除 
            - 招待リンクも無効化 
    5. チャットセッションの管理 
        ### セッションの開始 
        - 教員がルームに入った時点で新しいセッション開始 
        ### セッションの終了 
        - 以下のいずれかで終了: 
            - 教員が「終了」ボタンを押す 
            - 最後のメッセージから3時間経過で自動終了 
        -  ブラウザを閉じてもセッションは継続 (再アクセスで復帰可能) 
        ### 過去のメッセージ表示 
        - 教員が一度チャットルームを閉じると、次回接続時は新しいセッションとして表示される 
        - 過去のメッセージは表示されない(学生も見られない) 
        - チャットログは教員のみ閲覧・ダウンロード可能 
7. チャットログ 
    1. 保存 
        - 各チャットルームごとに、 過去のセッション一覧(開始日時付き)を保存 
        - 教員のみアクセス可能 
        - 保存期間の制限なし(データ量が多くなく、 定常的に増えるものでもないため) 
        - ルーム削除時にチャットログも削除 
    2. ダウンロード 
        - CSV形式でダウンロード可能 
        - ルーム作成者 (教員) のみダウンロード可能 
    3. CSV出力内容 
        - 必須項目: 
            - タイムスタンプ 
            - 送信者名 (またはID) 
            - 送信先名(またはID) ※全体チャットの場合は"ALL" 
            - メッセージ内容 
        - オプション項目(実装優先度低): 
            - スレッド情報(元メッセージIDなど) 
            - スタンプ情報 
8. 通知機能 
    1. 通知方式 
        - ブラウザ通知あり 
        - 音による通知なし 
    2. 通知タイミング 
        - 新しいメッセージ受信時 
        - 新しいDM受信時 
9. 実装しない機能 
    - 以下の機能は実装する予定がない: 
        - メッセージの編集機能 
        - メッセージの削除機能 
        - ファイル・画像の送信機能 
        - 音声通知 
        - 既読・未読表示機能 
        - 学生同士のDM機能 教員同士のDM機能 
10. 仕様確定項目 
    - 以下の項目はすべて確定: 
        - Google Meetとの連携方法: 独立したWebアプリケーションとして運用 
        - 複数の教員アカウントの設定方法: ルーム作成者が参加者を指定、セッションごとにリセット 
        - セッション自動終了の時間: 最後のメッセージから3時間経過 
        - チャットログの保存期間: 期限なし、 ルーム削除時に削除 
        - 招待リンクの有効期限: 期限なし、 ルーム削除時に無効化 